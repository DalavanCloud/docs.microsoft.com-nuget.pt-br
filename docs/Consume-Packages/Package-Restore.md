---
title: "Restauração do pacote do NuGet | Microsoft Docs"
author: kraigb
ms.author: kraigb
manager: ghogen
ms.date: 02/12/2018
ms.topic: article
ms.prod: nuget
ms.technology: 
ms.assetid: a7bf21da-86ae-4c2d-8750-04ff53f41967
description: "Uma visão geral de como o NuGet restaura os pacotes dos quais um projeto depende, incluindo como desabilitar a restauração e restringir as versões."
keywords: "Restauração de pacote do NuGet, instalação de pacote do NuGet, instalar o pacote, restaurando pacotes, versões de dependência, desabilitar a restauração automática, restringindo as versões do pacote"
ms.reviewer:
- karann-msft
- unniravindranathan
ms.openlocfilehash: 761ef86a70e0a681449dc9fe86d6a52ac2b19bb1
ms.sourcegitcommit: 74c21b406302288c158e8ae26057132b12960be8
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 03/15/2018
---
# <a name="package-restore"></a><span data-ttu-id="972e3-104">Restauração de pacote</span><span class="sxs-lookup"><span data-stu-id="972e3-104">Package Restore</span></span>

<span data-ttu-id="972e3-105">Para promover um ambiente de desenvolvimento mais limpo e reduzir o tamanho do repositório, a **Restauração de pacote** do NuGet instala todos os pacotes referenciados antes de um projeto ser compilado.</span><span class="sxs-lookup"><span data-stu-id="972e3-105">To promote a cleaner development environment and to reduce repository size, NuGet **Package Restore** installs all referenced packages before a project is built.</span></span> <span data-ttu-id="972e3-106">Esse recurso amplamente utilizado[disponível no Visual Studio, .NET Core 2.0+ e xbuild no Mono&mdash;garante que todas as dependências estejam disponíveis em um projeto sem precisar armazenar tais pacotes no controle do código-fonte (veja &mdash;Pacotes e controle do código-fonte](../consume-packages/packages-and-source-control.md) para ver como configurar seu repositório para excluir binários de pacote).</span><span class="sxs-lookup"><span data-stu-id="972e3-106">This widely-used feature&mdash;available in Visual Studio, .NET Core 2.0+, and xbuild on Mono&mdash;ensures that all dependencies are available in a project without requiring those packages to be stored in source control (see [Packages and Source Control](../consume-packages/packages-and-source-control.md) on how to configure your repository to exclude package binaries).</span></span> <span data-ttu-id="972e3-107">Você também pode restaurar manualmente os pacotes a qualquer momento.</span><span class="sxs-lookup"><span data-stu-id="972e3-107">You can also manually restore packages at any time.</span></span>

<span data-ttu-id="972e3-108">Para ver detalhes adicionais sobre a restauração de pacote nos servidores de build, consulte [Restauração de pacote com TFBuild](../consume-packages/team-foundation-build.md).</span><span class="sxs-lookup"><span data-stu-id="972e3-108">For additional details on package restore on build servers, see [Package restore with TFBuild](../consume-packages/team-foundation-build.md).</span></span>

## <a name="package-restore-overview"></a><span data-ttu-id="972e3-109">Visão geral de restauração de pacote</span><span class="sxs-lookup"><span data-stu-id="972e3-109">Package restore overview</span></span>

<span data-ttu-id="972e3-110">Primeiro, a restauração de pacotes instala as dependências diretas de um projeto conforme o necessário, depois instala todas as dependências desses pacotes em todo o grafo de dependência.</span><span class="sxs-lookup"><span data-stu-id="972e3-110">Restoring packages first installs the direct dependencies of a project as needed, then installing any dependencies of those packages throughout the entire dependency graph.</span></span>

<span data-ttu-id="972e3-111">Se um pacote ainda não estiver instalado, primeiro o NuGet tentará recuperá-lo do [cache](../consume-packages/managing-the-nuget-cache.md).</span><span class="sxs-lookup"><span data-stu-id="972e3-111">If a package is not already installed, NuGet first attempts to retrieve it from the [cache](../consume-packages/managing-the-nuget-cache.md).</span></span> <span data-ttu-id="972e3-112">Se o pacote não estiver no cache, o NuGet tentará baixar (e armazenar em cache) o pacote de todas as origens habilitadas (veja [Configurando o comportamento do NuGet](Configuring-NuGet-Behavior.md)); as origens também aparecem na lista **Ferramentas > Opções > Gerenciador de Pacotes do NuGet > Origens de Pacotes** no Visual Studio).</span><span class="sxs-lookup"><span data-stu-id="972e3-112">If the package is not in the cache, NuGet then attempts to download (and cache) the package from all enabled sources (see [Configuring NuGet behavior](Configuring-NuGet-Behavior.md)); sources also appear in the  **Tools > Options > NuGet Package Manager > Package Sources** list in Visual Studio).</span></span> <span data-ttu-id="972e3-113">O NuGet ignora a ordem das origens de pacotes usando o pacote de qualquer origem que responder às solicitações primeiro.</span><span class="sxs-lookup"><span data-stu-id="972e3-113">NuGet ignores the order of package sources, using the package from whichever source is first to respond to requests.</span></span>

> [!Note]
> <span data-ttu-id="972e3-114">O NuGet não indicará a falha na restauração de um pacote até que todas as origens sejam verificadas.</span><span class="sxs-lookup"><span data-stu-id="972e3-114">NuGet does not indicate a failure to restore a package until all the sources have been checked.</span></span> <span data-ttu-id="972e3-115">Nesse momento, o NuGet relatará a falha somente para a última origem na lista.</span><span class="sxs-lookup"><span data-stu-id="972e3-115">At that time, NuGet reports the failure for only the last source in the list.</span></span> <span data-ttu-id="972e3-116">O erro indica que o pacote não estava presente em *nenhuma* das outras origens, mesmo que os erros não sejam mostrados para cada um dessas fontes individualmente.</span><span class="sxs-lookup"><span data-stu-id="972e3-116">The error implies that the package wasn't present on *any* of the other sources, even though errors are not shown for each of those sources individually.</span></span>

<span data-ttu-id="972e3-117">A restauração do pacote é disparada das seguintes maneiras:</span><span class="sxs-lookup"><span data-stu-id="972e3-117">Package restore is triggered in the following ways:</span></span>

- <span data-ttu-id="972e3-118">**CLI do dotnet**: use o comando [dotnet restore](/dotnet/core/tools/dotnet-restore?tabs=netcore2x), que restaura os pacotes listados no arquivo do projeto (veja [PackageReference](../consume-packages/package-references-in-project-files.md)).</span><span class="sxs-lookup"><span data-stu-id="972e3-118">**dotnet CLI**: use the [dotnet restore](/dotnet/core/tools/dotnet-restore?tabs=netcore2x) command, which restores packages listed in the project file (see [PackageReference](../consume-packages/package-references-in-project-files.md)).</span></span> <span data-ttu-id="972e3-119">Com o .NET Core 2.0 e posterior, a restauração é feita automaticamente com `dotnet build` e `dotnet run`.</span><span class="sxs-lookup"><span data-stu-id="972e3-119">With .NET Core 2.0 and later, restore is done automatically with `dotnet build` and `dotnet run`.</span></span>

- <span data-ttu-id="972e3-120">**IU do Gerenciador de pacote (Visual Studio no Windows)**: os pacotes são restaurados automaticamente ao criar um projeto de um modelo e ao compilar um projeto (sujeito à opção descrita em [Habilitar e desabilitar a restauração do pacote](#enabling-and-disabling-package-restore)).</span><span class="sxs-lookup"><span data-stu-id="972e3-120">**Package Manager UI (Visual Studio on Windows)**: Packages are restored automatically when creating a project from a template and when building a project (subject to the option described in [Enabling and disabling package restore](#enabling-and-disabling-package-restore)).</span></span> <span data-ttu-id="972e3-121">No NuGet 4.0 +, a restauração também ocorre automaticamente quando as alterações são feitas em um projeto baseado no SDK do .NET Core.</span><span class="sxs-lookup"><span data-stu-id="972e3-121">In NuGet 4.0+, restore also happens automatically when changes are made to a .NET Core SDK-based project.</span></span>

    <span data-ttu-id="972e3-122">Para restaurar manualmente, clique com o botão direito na solução no Gerenciador de Soluções e selecione **Restaurar Pacotes NuGet**.</span><span class="sxs-lookup"><span data-stu-id="972e3-122">To restore manually, right-click the solution in Solution Explorer and select **Restore NuGet Packages**.</span></span> <span data-ttu-id="972e3-123">Se um ou mais pacotes individuais ainda não tiverem sido instalados corretamente (o que significa que o Gerenciador de Soluções mostra um ícone de erro), use a interface do usuário do Gerenciador de Pacotes para desinstalar e reinstalar os pacotes afetados.</span><span class="sxs-lookup"><span data-stu-id="972e3-123">If one or more individual packages are still not installed properly (meaning that Solution Explorer shows an error icon), then use the Package Manager UI to uninstall and reinstall the affected packages.</span></span> <span data-ttu-id="972e3-124">Consulte [Reinstalando e atualizando pacotes](../consume-packages/reinstalling-and-updating-packages.md)</span><span class="sxs-lookup"><span data-stu-id="972e3-124">See [Reinstalling and updating packages](../consume-packages/reinstalling-and-updating-packages.md)</span></span>

    <span data-ttu-id="972e3-125">Se você encontrar o erro “Este projeto faz referência a pacotes do NuGet que estão ausentes neste computador” ou “Um ou mais pacotes do NuGet precisam ser restaurados, mas não foi possível fazer isso, pois o consentimento não foi concedido”, ative a restauração automática seguindo as instruções em [Habilitando e desabilitando a restauração do pacote](#enabling-and-disabling-package-restore).</span><span class="sxs-lookup"><span data-stu-id="972e3-125">If you see the error "This project references NuGet package(s) that are missing on this computer" or "One or more NuGet packages need to be restored but couldn't be because consent has not been granted," turn on automatic restore by following the instructions under [Enabling and disabling package restore](#enabling-and-disabling-package-restore).</span></span>

- <span data-ttu-id="972e3-126">**CLI do NuGet**: use o comando [nuget restore](../tools/cli-ref-restore.md), que restaura os pacotes listados no arquivo do projeto (veja [PackageReference](../consume-packages/package-references-in-project-files.md)) ou em um arquivo [packages.config](../reference/packages-config.md).</span><span class="sxs-lookup"><span data-stu-id="972e3-126">**NuGet CLI**: use the [nuget restore](../tools/cli-ref-restore.md) command, which restores packages listed in the project file (see [PackageReference](../consume-packages/package-references-in-project-files.md)) or in a [packages.config](../reference/packages-config.md) file.</span></span> <span data-ttu-id="972e3-127">Você também pode especificar um arquivo de solução.</span><span class="sxs-lookup"><span data-stu-id="972e3-127">You can also specify a solution file.</span></span>

- <span data-ttu-id="972e3-128">**MSBuild**: use o comando [msbuild /t:restore](../reference/msbuild-targets.md#restore-target), que restaura os pacotes listados no arquivo do projeto (veja [PackageReference](../consume-packages/package-references-in-project-files.md)).</span><span class="sxs-lookup"><span data-stu-id="972e3-128">**MSBuild**: use the [msbuild /t:restore](../reference/msbuild-targets.md#restore-target) command, which restores packages packages listed in the project file (see [PackageReference](../consume-packages/package-references-in-project-files.md)).</span></span> <span data-ttu-id="972e3-129">Disponível apenas no NuGet 4.x e posterior e no MSBuild 15.1 e posterior, que são incluídos no Visual Studio 2017.</span><span class="sxs-lookup"><span data-stu-id="972e3-129">Available only in NuGet 4.x+ and MSBuild 15.1+, which are included with Visual Studio 2017.</span></span> <span data-ttu-id="972e3-130">`nuget restore` e `dotnet restore` usam esse comando para projetos aplicável.</span><span class="sxs-lookup"><span data-stu-id="972e3-130">`nuget restore` and `dotnet restore` both use this command for applicable projects.</span></span>

- <span data-ttu-id="972e3-131">**Visual Studio Team Services**: ao criar uma definição de compilação no Team Services, inclua a tarefa [Restaurar NuGet](/vsts/build-release/tasks/package/nuget#restore-nuget-packages) ou [Restaurar .NET Core](/vsts/build-release/tasks/build/dotnet-core#restore-nuget-packages) na definição do antes de qualquer tarefa de compilação.</span><span class="sxs-lookup"><span data-stu-id="972e3-131">**Visual Studio Team Services**: When creating a build definition on Team Services, include the [NuGet restore](/vsts/build-release/tasks/package/nuget#restore-nuget-packages) or [.NET Core Restore](/vsts/build-release/tasks/build/dotnet-core#restore-nuget-packages) task in the definition before any build task.</span></span> <span data-ttu-id="972e3-132">Essa tarefa é incluída por padrão em diversos modelos de build.</span><span class="sxs-lookup"><span data-stu-id="972e3-132">This task is included by default in a number of build templates.</span></span>

- <span data-ttu-id="972e3-133">**Team Foundation Server**: o TFS 2013 e posterior restaura automaticamente os pacotes durante a compilação, desde que você esteja usando um modelo do Team Build para TFS 2013 ou posterior.</span><span class="sxs-lookup"><span data-stu-id="972e3-133">**Team Foundation Server**: TFS 2013 and later automatically restores packages during build, provided that you're using a Team Build Template for TFS 2013 or later.</span></span> <span data-ttu-id="972e3-134">Para obter uma versão anterior do TFS, você pode incluir uma etapa de compilação para invocar uma das opções de restauração de linha de comando descritas anteriormente.</span><span class="sxs-lookup"><span data-stu-id="972e3-134">For earlier version of TFS, you can include a build step to invoke one of the command-line restore options above.</span></span> <span data-ttu-id="972e3-135">Opcionalmente, você pode migrar o modelo de compilação para o TFS 2013.</span><span class="sxs-lookup"><span data-stu-id="972e3-135">You can optionally migrate the build template to TFS 2013.</span></span> <span data-ttu-id="972e3-136">Para saber mais, veja o [Passo a passo da restauração de pacotes com o Team Foundation Build](../consume-packages/team-foundation-build.md).</span><span class="sxs-lookup"><span data-stu-id="972e3-136">For more information, see the [Walkthrough of package restore with Team Foundation Build](../consume-packages/team-foundation-build.md).</span></span>

## <a name="enabling-and-disabling-package-restore"></a><span data-ttu-id="972e3-137">Habilitar e desabilitar a restauração do pacote</span><span class="sxs-lookup"><span data-stu-id="972e3-137">Enabling and disabling package restore</span></span>

<span data-ttu-id="972e3-138">A restauração do pacote é habilitada primariamente por meio de **Ferramentas > Opções > Gerenciador de Pacotes do NuGet** no Visual Studio:</span><span class="sxs-lookup"><span data-stu-id="972e3-138">Package restore is primarily enabled through **Tools > Options > NuGet Package Manager** in Visual Studio:</span></span>

![Controlar comportamentos de restauração do pacote por meio de opções do Gerenciador de Pacotes do NuGet](media/Restore-01-AutoRestoreOptions.png)

- <span data-ttu-id="972e3-140">**Permitir que o NuGet baixe pacotes ausentes**: controla todas as formas de restauração de pacote alterando a configuração `packageRestore/enabled` no arquivo `NuGet.Config`, conforme mostrado abaixo (`%AppData%\NuGet\NuGet.Config` no Windows e `~/.nuget/NuGet/NuGet.Config` no Mac/Linux).</span><span class="sxs-lookup"><span data-stu-id="972e3-140">**Allow NuGet to download missing packages**: controls all forms of package restore by changing the `packageRestore/enabled` setting in the `NuGet.Config` file as shown below (`%AppData%\NuGet\NuGet.Config` on Windows, `~/.nuget/NuGet/NuGet.Config` on Mac/Linux).</span></span> <span data-ttu-id="972e3-141">No Visual Studio, essa configuração permite que o comando **Restaurar Pacotes NuGet** no menu de contexto da solução funcione.</span><span class="sxs-lookup"><span data-stu-id="972e3-141">In Visual Studio, this setting allows the **Restore NuGet Packages** command on the solution's context menu to work.</span></span>

    ```xml
    <configuration>
        <packageRestore>
            <!-- The 'enabled' key is True when the "Allow NuGet to download missing packages" checkbox is set.
                 Clearing the box sets this to False, disabling command-line, automatic, and MSBuild-Integrated restore. -->
            <add key="enabled" value="True" />
        </packageRestore>
    </configuration>
    ```
    <br/>
    > [!Note]
    >  <span data-ttu-id="972e3-142">A configuração `packageRestore/enabled` pode ser substituída globalmente definindo uma variável de ambiente chamada **EnableNuGetPackageRestore** com um valor de TRUE ou FALSE antes de abrir o Visual Studio ou iniciar um build.</span><span class="sxs-lookup"><span data-stu-id="972e3-142">The `packageRestore/enabled` setting can be overridden globally by setting an environment variable called **EnableNuGetPackageRestore** with a value of TRUE or FALSE before launching Visual Studio or starting a build.</span></span>

- <span data-ttu-id="972e3-143">**Verificar automaticamente os pacotes ausentes durante o build no Visual Studio**: controla a restauração automática alterando a configuração `packageRestore/automatic` no arquivo `NuGet.Config`, conforme mostrado abaixo (`%AppData%\NuGet\NuGet.Config` no Windows e `~/.nuget/NuGet/NuGet.Config` no Mac/Linux).</span><span class="sxs-lookup"><span data-stu-id="972e3-143">**Automatically check for missing packages during build in Visual Studio**: controls automatic restore by changing the `packageRestore/automatic` setting in the `NuGet.Config` file as shown below (`%AppData%\NuGet\NuGet.Config` on Windows, `~/.nuget/NuGet/NuGet.Config` on Mac/Linux).</span></span> <span data-ttu-id="972e3-144">Quando essa opção for definida, executar um build no Visual Studio automaticamente restaurará todos os pacotes ausentes.</span><span class="sxs-lookup"><span data-stu-id="972e3-144">When this option is set, running a build from Visual Studio automatically restores any missing packages.</span></span> <span data-ttu-id="972e3-145">A opção não afetará os builds executados na linha de comando usando o MSBuild.</span><span class="sxs-lookup"><span data-stu-id="972e3-145">The option does not affect builds run from the command line using MSBuild.</span></span>

    ```xml
    ...
    <configuration>
        <packageRestore>
            <!-- The 'automatic' key is set to True when the "Automatically check for missing packages during
                 build in Visual Studio" checkbox is set. Clearing the box sets this to False and disables
                 automatic restore. -->
            <add key="automatic" value="True" />
        </packageRestore>
    </configuration>
    ```

<span data-ttu-id="972e3-146">Para referência, consulte o [Arquivo de configuração do NuGet – Seção packageRestore](../reference/nuget-config-file.md#packagerestore-section).</span><span class="sxs-lookup"><span data-stu-id="972e3-146">For reference, see the [NuGet config file - packageRestore section](../reference/nuget-config-file.md#packagerestore-section).</span></span>

<span data-ttu-id="972e3-147">Em alguns casos, um desenvolvedor ou empresa podem optar por habilitar ou desabilitar a restauração de pacotes para todos os usuários em um computador.</span><span class="sxs-lookup"><span data-stu-id="972e3-147">In some cases, a developer or company might want to enable or disable package restore for all users on a computer.</span></span> <span data-ttu-id="972e3-148">Isso é feito adicionando as mesmas configurações acima ao arquivo de configuração global do NuGet localizado em `%ProgramData%\NuGet\Config[\{IDE}[\{Version}[\{SKU}]]]`.</span><span class="sxs-lookup"><span data-stu-id="972e3-148">This is done by adding the same settings above to the global NuGet configuration file located in `%ProgramData%\NuGet\Config[\{IDE}[\{Version}[\{SKU}]]]`.</span></span> <span data-ttu-id="972e3-149">Usuários individuais poderão, então, habilitar seletivamente a restauração conforme necessário no nível do projeto.</span><span class="sxs-lookup"><span data-stu-id="972e3-149">Individual users can then selectively enable restore as needed on a project level.</span></span> <span data-ttu-id="972e3-150">Confira [Configurando o comportamento do NuGet](../consume-packages/configuring-nuget-behavior.md#how-settings-are-applied) para ver os detalhes sobre como o NuGet prioriza vários arquivos de configuração.</span><span class="sxs-lookup"><span data-stu-id="972e3-150">See [Configuring NuGet behavior](../consume-packages/configuring-nuget-behavior.md#how-settings-are-applied) for exact details on how NuGet prioritizes multiple config files.</span></span>

## <a name="constraining-package-versions-with-restore"></a><span data-ttu-id="972e3-151">Restrições de versões de pacote com restauração</span><span class="sxs-lookup"><span data-stu-id="972e3-151">Constraining package versions with restore</span></span>

<span data-ttu-id="972e3-152">Ao restaurar pacotes por meio de qualquer método, o NuGet aceita quaisquer restrições especificadas no `packages.config` ou no arquivo de projeto:</span><span class="sxs-lookup"><span data-stu-id="972e3-152">When restoring packages through any method, NuGet honors any constraints specified in `packages.config` or the project file:</span></span>

- <span data-ttu-id="972e3-153">`packages.config`: especifique um intervalo de versão na propriedade `allowedVersion` da dependência.</span><span class="sxs-lookup"><span data-stu-id="972e3-153">`packages.config`: Specify a version range in the `allowedVersion` property of the dependency.</span></span> <span data-ttu-id="972e3-154">Confira [Reinstalando e atualizando pacotes](../consume-packages/reinstalling-and-updating-packages.md#constraining-upgrade-versions).</span><span class="sxs-lookup"><span data-stu-id="972e3-154">See [Reinstalling and updating packages](../consume-packages/reinstalling-and-updating-packages.md#constraining-upgrade-versions).</span></span> <span data-ttu-id="972e3-155">Por exemplo:</span><span class="sxs-lookup"><span data-stu-id="972e3-155">For example:</span></span>

    ```xml
    <package id="Newtonsoft.json" version="6.0.4" allowedVersions="[6,7)" />
    ```

- <span data-ttu-id="972e3-156">PackageReference: especifique um intervalo de versão diretamente com o número de versão da dependência.</span><span class="sxs-lookup"><span data-stu-id="972e3-156">PackageReference: Specify a version range directly with the dependency's version number.</span></span> <span data-ttu-id="972e3-157">Por exemplo:</span><span class="sxs-lookup"><span data-stu-id="972e3-157">For example:</span></span>

    ```xml
    <PackageReference Include="Newtonsoft.json" Version="[6, 7)" />
    ```

<span data-ttu-id="972e3-158">Em todo os casos, use a notação descrita em [Controle de versão do pacote](../reference/package-versioning.md).</span><span class="sxs-lookup"><span data-stu-id="972e3-158">In all cases, use the notation described in [Package versioning](../reference/package-versioning.md).</span></span>

## <a name="troubleshooting"></a><span data-ttu-id="972e3-159">Solução de problemas</span><span class="sxs-lookup"><span data-stu-id="972e3-159">Troubleshooting</span></span>

<span data-ttu-id="972e3-160">Confira [Solucionar problemas de restauração de pacotes](package-restore-troubleshooting.md).</span><span class="sxs-lookup"><span data-stu-id="972e3-160">See [Troubleshooting package restore](package-restore-troubleshooting.md).</span></span>